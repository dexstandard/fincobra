{$DOMAIN} {
    encode gzip zstd

    @api path /api* /healthz
    handle @api {
        reverse_proxy backend:3000
    }

    root * /usr/share/caddy
    file_server

    # SPA fallback: only if file doesn’t exist and isn’t /api
    @notStatic {
        not path /api*
        not file
    }
    handle @notStatic {
        rewrite * /index.html
    }

    log {
        output stdout
        format console
    }
}
