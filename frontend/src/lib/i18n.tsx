/* eslint-disable react-refresh/only-export-components */
import { createContext, useContext, useState, type ReactNode } from 'react';

export type Lang = 'en' | 'ru';

const translations: Record<Lang, Record<string, string>> = {
  en: {
    online: 'Online',
    offline: 'Offline',
    workflows: 'Portfolio Workflows',
    keys: 'Keys',
    settings: 'Settings',
    users: 'Users',
    terms: 'Terms',
    privacy: 'Privacy',
    terms_title: 'Terms of Use',
    terms_intro:
      'Welcome to FinCobra, an experimental trading assistant currently in alpha.',
    terms_disclaimer:
      'FinCobra is provided “as is” without any warranties or guarantees. Use it at your own risk.',
    terms_access:
      'Access is for private use only. Features may change over time, and access may be revoked if misuse is detected.',
    terms_safety_heading: 'For your safety:',
    terms_safety_item_enable_2fa: 'Enable 2FA on your exchange accounts.',
    terms_safety_item_no_withdrawals: 'Never allow withdrawals in your API keys.',
    terms_safety_item_openai_billing:
      'If you add your own OpenAI API key, note that OpenAI will bill you for the models you use.',
    terms_free_stage:
      'The service is free to use in this alpha stage, and the authors assume no liability for any outcomes.',
    terms_responsible_use:
      'By using FinCobra, you agree to these terms and use the service responsibly.',
    privacy_title: 'Privacy Policy',
    privacy_p1:
      'We collect only the information required to run the service. When you sign in with Google we record your Google account ID. Your email is stored encrypted and used only for platform-related notifications. Workflow configuration data and optional two-factor authentication secrets are also saved.',
    privacy_p2:
      'API keys for AI providers and exchanges, as well as your email address, are encrypted using a server-side password before being saved in our database. These keys are used solely to make requests on your behalf and are never shared with third parties.',
    privacy_p3:
      'You may delete your API keys or disable two-factor authentication at any time from the application settings.',
    language: 'Language',
    please_log_in: 'Please log in.',
    loading: 'Loading...',
    ios_add_to_home_screen_title: 'Add FinCobra to your Home Screen',
    ios_add_to_home_screen_instructions:
      'Tap the share icon in Safari and choose “Add to Home Screen” to launch FinCobra like an app.',
    twofa_enabled: 'Two-factor authentication is enabled.',
    code: 'Code',
    disable: 'Disable',
    scan_qr_prompt:
      'Scan this QR code with Google Authenticator and enter the code.',
    secret: 'Secret',
    copy_secret: 'Copy secret',
    copied: 'Copied to clipboard',
    enable: 'Enable',
    setup_2fa: 'Setup 2FA',
    api_keys_notice:
      'Your API keys are encrypted using AES-256 and stored only on our server. They are decrypted solely when needed to call providers and are never shared.',
    openai_api_key: 'OpenAI API Key',
    openai_api_key_shared: 'OpenAI API Key (Shared)',
    binance_api_credentials: 'Binance API Credentials',
    bybit_api_credentials: 'Bybit API Credentials',
    binance_balances: 'Binance Balances',
    bybit_futures_balances: 'Bybit Futures Balances',
    spot_trading: 'Spot trading',
    futures_trading: 'Futures trading',
    binance_capabilities:
      'Supports Binance spot trading, Earn balances, and USD value previews.',
    bybit_capabilities:
      'Supports Bybit USDT perpetual futures trading with leverage controls.',
    trading_mode: 'Trading mode',
    trading_mode_spot_description:
      'Spot bots trade from your Binance spot wallet and can include Earn balances when enabled.',
    trading_mode_futures_description:
      'Futures bots trade from your Bybit USDT perpetual account with leverage-aware execution.',
    trading_mode_connect_exchange:
      'Connect your {{exchange}} API key to enable this mode.',
    connect_binance_api: 'Connect your Binance API',
    connect_exchange_api: 'Connect your exchange API',
    my_workflows: 'Portfolios',
    only_active: 'Only Active',
    only_my: 'Only My',
    please_log_in_workflows: 'Please log in to view your portfolios.',
    no_workflows_yet:
      'Connect your exchange account to create your first Portfolio Workflow.',
    no_workflows_yet_connected:
      'Click the + above to create your first Portfolio Workflow.',
    tokens: 'Tokens',
    balance_usd: 'Balance',
    pnl_usd: 'PnL',
    model: 'Model',
    interval: 'Interval',
    owner: 'Owner',
    status: 'Status',
    prev: 'Prev',
    next: 'Next',
    delete_workflow_prompt: 'Delete this portfolio workflow?',
    workflow_deleted: 'Portfolio workflow deleted',
    failed_delete_workflow: 'Failed to delete portfolio workflow',
    login_failed: 'Login failed',
    enter_2fa_code: 'Enter 2FA code',
    cancel: 'Cancel',
    confirm: 'Confirm',
    delete_workflow: 'Delete portfolio workflow',
    view_workflow: 'View portfolio workflow',
    twofa_enabled_success: '2FA enabled',
    twofa_disabled_success: '2FA disabled',
    failed_start_2fa_setup: 'Failed to start 2FA setup',
    failed_enable_2fa: 'Failed to enable 2FA',
    failed_disable_2fa: 'Failed to disable 2FA',
    too_many_requests: 'Too many requests. Please try again later.',
    api_key: 'API key',
    api_secret: 'API secret',
    video_guide: 'Video guide',
    fields_required_min_length:
      'All fields are required and must be at least 10 characters',
    update: 'Update',
    save: 'Save',
    edit: 'Edit',
    delete: 'Delete',
    delete_key_confirm:
      'Deleting this key will stop all active portfolio workflows. Continue?',
    shared_by_admin: 'Shared by admin',
    whitelist_ip: 'Whitelist IP:',
    share: 'Share',
    revoke: 'Revoke',
    enter_email_share: 'Enter email to share with',
    select_model: 'Select model',
    failed_fetch_models: 'Failed to fetch models',
    enter_email_revoke: 'Enter email to revoke',
    key_verification_failed: 'Key verification failed',
    failed_save_exchange_key: 'Failed to save exchange API key',
    copy_ip: 'Copy IP',
    balance: 'Balance',
    earn: 'Earn',
    pnl: 'PnL',
    price_history: 'Price History',
    failed_render_chart: 'Failed to render chart',
    failed_load_price_data: 'Failed to load price data',
    create_workflow: 'Portfolio Workflow',
    token1: 'Token 1',
    token2: 'Token 2',
    min_token_allocation: 'Min {token} allocation',
    risk_tolerance: 'Risk Tolerance',
    risk_low: 'Low',
    risk_medium: 'Medium',
    risk_high: 'High',
    review_interval: 'Review Interval',
    review_interval_tooltip:
      'How often the portfolio workflow will review the portfolio; it may not rebalance every time.',
    review_interval_10m: '10 Minutes',
    review_interval_15m: '15 Minutes',
    review_interval_30m: '30 Minutes',
    review_interval_1h: '1 Hour',
    review_interval_3h: '3 Hours',
    review_interval_5h: '5 Hours',
    review_interval_12h: '12 Hours',
    review_interval_24h: '1 Day',
    review_interval_3d: '3 Days',
    review_interval_1w: '1 Week',
    use_binance_earn: 'Binance Earn:',
    log_in_to_continue: 'Log in to continue',
    preview: 'Preview',
    workflow: 'Portfolio Workflow',
    created: 'Created',
    trading_instructions: 'Trading Instructions',
    workflow_setup: 'Workflow Setup',
    ai_provider: 'AI Provider',
    exchange: 'Exchange',
    manual_rebalancing: 'Manual Rebalancing',
    update_setup: 'Update Workflow',
    save_setup: 'Save Workflow',
    setup_saved_successfully: 'Workflow saved successfully',
    failed_save_setup: 'Failed to save workflow',
    trading_agent_warning:
      'Trading portfolio workflow will use all available balance for {tokens} in your Binance Spot wallet. Move excess funds to the futures wallet before trading.',
    dont_move_funds_warning:
      "DON'T MOVE FUNDS FROM SPOT WALLET DURING TRADING! It will confuse the trading agent and may lead to unexpected results.",
    update_workflow: 'Edit Workflow',
    failed_update_workflow: 'Failed to update portfolio workflow',
    update_running_workflow_prompt: 'Update running portfolio workflow?',
    update_workflow_prompt: 'Update portfolio workflow?',
    and: 'and',
    execution_log: 'Execution Log',
    start_workflow: 'Start Workflow',
    stop_workflow: 'Stop Workflow',
    stop_workflow_short: 'Stop',
    run_review: 'Run Review',
    failed_run_review: 'Failed to run review',
    admin_viewing_workflow: 'Viewing workflow for',
    run_rebalance: 'Run Rebalance',
    rebalance: 'Rebalance',
    hold: 'Hold',
    decision: 'Decision',
    error: 'Error',
    short_report: 'Short Report',
    strategy: 'Strategy',
    strategy_name: 'Strategy Name',
    strategy_rationale: 'Rationale',
    orders: 'Orders',
    no_orders: 'No orders.',
    pair: 'Pair',
    token: 'Token',
    limit_price: 'Limit Price',
    base_price: 'Base Price',
    max_price_drift_pct: 'Max Price Drift %',
    confirm_rebalance: 'Confirm Rebalance',
    quantity: 'Quantity',
    price: 'Price',
    side: 'Side',
    failed_load_prompt: 'Failed to load prompt',
    only_rebalances: 'Only Rebalances',
    no_logs_yet: 'No logs yet.',
    time: 'Time',
    log: 'Log',
    start_workflow_confirm: 'Start portfolio workflow with current settings?',
    model_required: 'Model is required',
    workflow_started_success: 'Portfolio workflow started successfully',
    failed_start_workflow: 'Failed to start portfolio workflow',
    close: 'Close',
  },
  ru: {
    online: 'Онлайн',
    offline: 'Офлайн',
    workflows: 'Управление Портфолио',
    keys: 'Ключи',
    settings: 'Настройки',
    users: 'Пользователи',
    terms: 'Условия',
    privacy: 'Конфиденциальность',
    terms_title: 'Условия использования',
    terms_intro:
      'Добро пожаловать в FinCobra — экспериментальный торговый ассистент в статусе альфа.',
    terms_disclaimer:
      'FinCobra предоставляется «как есть» без каких-либо гарантий. Используйте сервис на свой страх и риск.',
    terms_access:
      'Доступ предназначен только для частного использования. Функциональность может меняться, а доступ может быть отозван при обнаружении злоупотреблений.',
    terms_safety_heading: 'Для вашей безопасности:',
    terms_safety_item_enable_2fa: 'Включайте 2FA на своих счетах бирж.',
    terms_safety_item_no_withdrawals: 'Никогда не разрешайте вывод средств в API-ключах.',
    terms_safety_item_openai_billing:
      'Если вы добавляете собственный API-ключ OpenAI, помните, что OpenAI выставит вам счёт за используемые модели.',
    terms_free_stage:
      'Сервис бесплатен на этапе альфа-тестирования, авторы не несут ответственности за результаты.',
    terms_responsible_use:
      'Используя FinCobra, вы соглашаетесь с этими условиями и обязуетесь пользоваться сервисом ответственно.',
    privacy_title: 'Политика конфиденциальности',
    privacy_p1:
      'Мы собираем только информацию, необходимую для работы сервиса. При входе через Google мы сохраняем идентификатор вашей учетной записи Google. Ваш email хранится в зашифрованном виде и используется только для уведомлений, связанных с платформой. Также сохраняются данные конфигурации workflow и, при необходимости, секреты двухфакторной аутентификации.',
    privacy_p2:
      'API‑ключи поставщиков ИИ и бирж, а также ваш email шифруются серверным паролем перед сохранением в нашей базе данных. Эти ключи используются исключительно для запросов от вашего имени и никогда не передаются третьим лицам.',
    privacy_p3:
      'Вы можете удалить свои API‑ключи или отключить двухфакторную аутентификацию в настройках приложения в любое время.',
    language: 'Язык',
    please_log_in: 'Пожалуйста, войдите.',
    loading: 'Загрузка...',
    ios_add_to_home_screen_title: 'Добавьте FinCobra на главный экран',
    ios_add_to_home_screen_instructions:
      'Нажмите на иконку «Поделиться» в Safari и выберите «На экран “Домой”», чтобы запускать FinCobra как приложение.',
    twofa_enabled: 'Двухфакторная аутентификация включена.',
    code: 'Код',
    disable: 'Отключить',
    scan_qr_prompt:
      'Отсканируйте этот QR-код в Google Authenticator и введите код.',
    secret: 'Секрет',
    copy_secret: 'Скопировать секрет',
    copied: 'Скопировано в буфер обмена',
    enable: 'Включить',
    setup_2fa: 'Настроить 2FA',
    api_keys_notice:
      'Ваши API‑ключи шифруются с помощью AES-256 и хранятся только на нашем сервере. Они расшифровываются только при необходимости обращения к провайдерам и никогда не передаются третьим лицам.',
    openai_api_key: 'OpenAI API ключ',
    openai_api_key_shared: 'OpenAI API ключ (общий)',
    binance_api_credentials: 'Учётные данные Binance API',
    bybit_api_credentials: 'Учётные данные Bybit API',
    binance_balances: 'Балансы Binance',
    bybit_futures_balances: 'Балансы фьючерсов Bybit',
    spot_trading: 'Спот-торговля',
    futures_trading: 'Фьючерсная торговля',
    binance_capabilities:
      'Поддерживает спот-торговлю на Binance, балансы Earn и просмотр стоимости в USD.',
    bybit_capabilities:
      'Поддерживает торговлю фьючерсами USDT perpetual на Bybit с управлением плечом.',
    trading_mode: 'Режим торговли',
    trading_mode_spot_description:
      'Спотовые боты работают с вашим спотовым кошельком Binance и при необходимости учитывают балансы Earn.',
    trading_mode_futures_description:
      'Фьючерсные боты работают с вашим счётом Bybit USDT perpetual и учитывают настройки плеча.',
    trading_mode_connect_exchange:
      'Подключите API ключ {{exchange}}, чтобы включить этот режим.',
    connect_binance_api: 'Подключите ваш Binance API',
    connect_exchange_api: 'Подключите API биржи',
    my_workflows: 'Портфели',
    only_active: 'Только активные',
    only_my: 'Только мои',
    please_log_in_workflows:
      'Пожалуйста, войдите, чтобы увидеть ваши портфолио.',
    no_workflows_yet:
      'Подключите API биржи, чтобы создать первый Workflow портфолио.',
    no_workflows_yet_connected:
      'Нажмите на + выше, чтобы создать первый Workflow портфолио.',
    tokens: 'Токены',
    balance_usd: 'Баланс',
    pnl_usd: 'PnL',
    model: 'Модель',
    interval: 'Интервал',
    owner: 'Владелец',
    status: 'Статус',
    prev: 'Пред',
    next: 'След',
    delete_workflow_prompt: 'Удалить это портфолио?',
    workflow_deleted: 'Портфолио удалено',
    failed_delete_workflow: 'Не удалось удалить портфолио',
    login_failed: 'Не удалось войти',
    enter_2fa_code: 'Введите код 2FA',
    cancel: 'Отмена',
    confirm: 'Подтвердить',
    delete_workflow: 'Удалить портфолио',
    view_workflow: 'Просмотреть портфолио',
    twofa_enabled_success: '2FA включена',
    twofa_disabled_success: '2FA отключена',
    failed_start_2fa_setup: 'Не удалось начать настройку 2FA',
    failed_enable_2fa: 'Не удалось включить 2FA',
    failed_disable_2fa: 'Не удалось отключить 2FA',
    too_many_requests: 'Слишком много запросов. Повторите позже.',
    api_key: 'API ключ',
    api_secret: 'API секрет',
    video_guide: 'Видео инструкция',
    fields_required_min_length:
      'Все поля обязательны и должны быть не менее 10 символов',
    update: 'Обновить',
    save: 'Сохранить',
    edit: 'Редактировать',
    delete: 'Удалить',
    delete_key_confirm:
      'Удаление этого ключа остановит все активные портфолио. Продолжить?',
    shared_by_admin: 'Предоставлено администратором',
    whitelist_ip: 'Белый список IP:',
    share: 'Поделиться',
    revoke: 'Отозвать',
    enter_email_share: 'Введите email для совместного использования',
    select_model: 'Выберите модель',
    failed_fetch_models: 'Не удалось получить список моделей',
    enter_email_revoke: 'Введите email для отзыва',
    key_verification_failed: 'Проверка ключа не удалась',
    failed_save_exchange_key: 'Не удалось сохранить ключ биржи',
    copy_ip: 'Скопировать IP',
    balance: 'Баланс',
    earn: 'Earn',
    pnl: 'PnL',
    price_history: 'История цен',
    failed_render_chart: 'Не удалось отобразить график',
    failed_load_price_data: 'Не удалось загрузить данные цен',
    create_workflow: 'Управление Портфолио',
    token1: 'Токен 1',
    token2: 'Токен 2',
    min_token_allocation: 'Мин. доля {token}',
    risk_tolerance: 'Допустимый риск',
    risk_low: 'Низкий',
    risk_medium: 'Средний',
    risk_high: 'Высокий',
    review_interval: 'Интервал проверки',
    review_interval_tooltip:
      'Как часто управление портфолио будет проверять портфель; ребаланс может происходить не каждый раз.',
    review_interval_10m: '10 минут',
    review_interval_15m: '15 минут',
    review_interval_30m: '30 минут',
    review_interval_1h: '1 час',
    review_interval_3h: '3 часа',
    review_interval_5h: '5 часов',
    review_interval_12h: '12 часов',
    review_interval_24h: '1 день',
    review_interval_3d: '3 дня',
    review_interval_1w: '1 неделя',
    use_binance_earn: 'Binance Earn:',
    log_in_to_continue: 'Войдите, чтобы продолжить',
    preview: 'Предпросмотр',
    workflow: 'Управление Портфолио',
    created: 'Создан',
    trading_instructions: 'Торговые инструкции',
    workflow_setup: 'Настройка портфолио',
    ai_provider: 'Провайдер ИИ',
    exchange: 'Биржа',
    manual_rebalancing: 'Ручная ребалансировка',
    update_setup: 'Обновить настройки',
    save_setup: 'Сохранить настройки',
    setup_saved_successfully: 'Настройки успешно сохранены',
    failed_save_setup: 'Не удалось сохранить настройки',
    trading_agent_warning:
      'Торговое управление портфолио использует весь доступный баланс для {tokens} на вашем Binance Spot кошельке. Перед началом торговли переместите лишние средства на фьючерсный кошелёк.',
    dont_move_funds_warning:
      'НЕ ПЕРЕВОДИТЕ СРЕДСТВА СО SPOT-КОШЕЛКА ВО ВРЕМЯ ТОРГОВЛИ! Это собьёт торгового агента и может привести к непредсказуемым результатам.',
    update_workflow: 'Редактировать портфолио',
    failed_update_workflow: 'Не удалось обновить портфолио',
    update_running_workflow_prompt: 'Обновить активное портфолио?',
    update_workflow_prompt: 'Обновить портфолио?',
    and: 'и',
    execution_log: 'Журнал выполнения',
    start_workflow: 'Запустить портфолио',
    stop_workflow: 'Остановить портфолио',
    stop_workflow_short: 'Остановить',
    run_review: 'Запустить проверку',
    failed_run_review: 'Не удалось запустить проверку',
    admin_viewing_workflow: 'Просмотр рабочего процесса пользователя',
    run_rebalance: 'Запустить ребаланс',
    rebalance: 'Ребаланс',
    hold: 'Держать',
    decision: 'Решение',
    error: 'Ошибка',
    short_report: 'Краткий отчет',
    strategy: 'Стратегия',
    strategy_name: 'Название стратегии',
    strategy_rationale: 'Обоснование',
    orders: 'Ордеры',
    no_orders: 'Ордеров нет.',
    pair: 'Пара',
    token: 'Токен',
    limit_price: 'Лимитная цена',
    base_price: 'Базовая цена',
    max_price_drift_pct: 'Макс. отклонение цены %',
    confirm_rebalance: 'Подтвердить ребаланс',
    quantity: 'Количество',
    price: 'Цена',
    side: 'Сторона',
    failed_load_prompt: 'Не удалось загрузить промпт',
    only_rebalances: 'Только ребалансы',
    no_logs_yet: 'Пока нет логов.',
    time: 'Время',
    log: 'Лог',
    start_workflow_confirm: 'Запустить портфолио с текущими настройками?',
    model_required: 'Требуется модель',
    workflow_started_success: 'Портфолио успешно запущено',
    failed_start_workflow: 'Не удалось запустить портфолио',
    close: 'Закрыть',
  },
};

const LanguageContext = createContext<{
  lang: Lang;
  setLang: (lang: Lang) => void;
}>({
  lang: 'en',
  setLang: () => {},
});

export function LanguageProvider({ children }: { children: ReactNode }) {
  const [lang, setLangState] = useState<Lang>(
    (localStorage.getItem('lang') as Lang) || 'en',
  );

  const setLang = (l: Lang) => {
    setLangState(l);
    localStorage.setItem('lang', l);
  };

  return (
    <LanguageContext.Provider value={{ lang, setLang }}>
      {children}
    </LanguageContext.Provider>
  );
}

export function useLanguage() {
  return useContext(LanguageContext);
}

export function useTranslation() {
  const { lang } = useLanguage();
  return (key: string) => translations[lang][key] ?? key;
}
